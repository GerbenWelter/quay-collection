---
- name: Testing the quay_organization module
  hosts: localhost
  become: false
  gather_facts: false
  vars:
    quay_url: http://localhost:8080
    token: wQwO9gt0iv9eq1vjpc7POcMbKALhlKrF8Uw3rZGO

  tasks:
    - name: Ensure organization testansible1 exists
      herve4m.quay.quay_organization:
        name: testansible1
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure organization testansible2 exists
      herve4m.quay.quay_organization:
        name: testansible2
        time_machine_expiration: "7d"
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    # Renaming requires superuser permissions
    - name: Ensure organization testansible2 is renamed
      herve4m.quay.quay_organization:
        name: testansible2
        new_name: testansible3
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure organization testansible2 is renamed (no change)
      herve4m.quay.quay_organization:
        name: testansible2
        new_name: testansible3
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure organization testansible3 has a new time machine expiration
      herve4m.quay.quay_organization:
        name: testansible3
        time_machine_expiration: "1d"
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure organization testansible3 has the same expiration (no change)
      herve4m.quay.quay_organization:
        name: testansible3
        time_machine_expiration: "1d"
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure organization testansible4 exists
      herve4m.quay.quay_organization:
        name: nonexistingname
        new_name: testansible4
        state: present
        time_machine_expiration: "1month"
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the organizations are removed
      herve4m.quay.quay_organization:
        name: "{{ item }}"
        state: absent
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false
      loop:
        - testansible1
        - testansible2
        - testansible3
        - testansible4
...
