---
- name: Testing the quay_application module
  hosts: localhost
  become: false
  gather_facts: false
  vars:
    quay_url: http://localhost:8080
    token: 7W4OnD9yKfqNNnKM3BTuKAut4c4cRiyLGp2YR60V

  tasks:
    # Supporting organization
    - name: Ensure organization ansibletestorg exists
      herve4m.quay.quay_organization:
        name: ansibletestorg
        email: ansibletestorg@example.com
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp1 exists
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: ansibletestapp1
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp1 is updated
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: ansibletestapp1
        description: Application 1 description
        application_uri: http://applicationuri.example.com
        redirect_uri: http://redirecturi.example.com
        avatar_email: avatarapp1@example.com
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp1 is updated (no change)
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: ansibletestapp1
        description: Application 1 description
        application_uri: http://applicationuri.example.com
        redirect_uri: http://redirecturi.example.com
        avatar_email: avatarapp1@example.com
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp1 is updated 2 (no change)
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: ansibletestapp1
        avatar_email: avatarapp1@example.com
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp1 is updated 3
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: ansibletestapp1
        description: ""
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp1 is renamed (ansibletestapp2)
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: ansibletestapp1
        new_name: ansibletestapp2
        description: "Renamed to ansibletestapp2"
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp1 does not exist (no change)
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: ansibletestapp1
        state: absent
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the application ansibletestapp3 exists (new name)
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: doesnotexist
        new_name: ansibletestapp3
        description: "New ansibletestapp3 application"
        state: present
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false

    - name: Ensure the applications are removed
      herve4m.quay.quay_application:
        organization: ansibletestorg
        name: "{{ item }}"
        description: "New ansibletestapp3 application"
        state: absent
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false
      loop:
        - ansibletestapp1
        - ansibletestapp2
        - ansibletestapp3

    - name: Ensure the organization is removed
      herve4m.quay.quay_organization:
        name: ansibletestorg
        state: absent
        quay_host: "{{ quay_url }}"
        quay_token: "{{ token }}"
        validate_certs: false
...
